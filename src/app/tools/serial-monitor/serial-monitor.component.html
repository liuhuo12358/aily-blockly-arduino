@if (currentUrl == "/serial-monitor") {
<app-sub-window [title]="'MONITOR'" [winBtns]="['go-main', 'minimize', 'maximize', 'close']">
  <ng-container *ngTemplateOutlet="windowBoxTemplate"></ng-container>
</app-sub-window>
} @else {
<app-tool-container [title]="'MONITOR'" [path]="'/serial-monitor'" (closeEvent)="close()">
  <ng-container *ngTemplateOutlet="windowBoxTemplate"></ng-container>
</app-tool-container>
}
<ng-template #windowBoxTemplate>
  <div class="window-box">
    <!-- <div class="left-bar">
      <div class="btn ccenter selected" nz-tooltip nzTooltipTitle="基础设置" nzTooltipPlacement="left">
        <i class="fa-light fa-gear"></i>
      </div>
      <div class="btn ccenter" nz-tooltip nzTooltipTitle="图表显示" nzTooltipPlacement="left">
        <i class="fa-light fa-chart-line"></i>
      </div>
      <div class="btn ccenter" nz-tooltip nzTooltipTitle="调试辅助" nzTooltipPlacement="left">
        <i class="fa-light fa-bug"></i>
      </div>
      <div class="btn ccenter" nz-tooltip nzTooltipTitle="自动化" nzTooltipPlacement="left">
        <i class="fa-light fa-code-branch"></i>
      </div>
      <div class="btn ccenter" nz-tooltip nzTooltipTitle="高亮设置" nzTooltipPlacement="left">
        <i class="fa-light fa-paint-roller"></i>
      </div>
      <div class="btn ccenter" nz-tooltip nzTooltipTitle="快捷发送" nzTooltipPlacement="left">
        <i class="fa-light fa-keyboard"></i>
      </div>
    </div> -->
    <div class="main-box">
      <div class="settings">
        <div class="line">
          <div class="item">
            <div class="title">{{ 'SERIAL.PORT' | translate }}</div>
            <div class="item-inner ccenter" (click)="openPortList($event)">
              <div class="value">{{currentPort}}</div>
              <div class="arrow-box">
                <i class="fa-light fa-angle-right arrow" [ngClass]="{'down':showPortList}"></i>
              </div>
            </div>
          </div>
          <div class="item">
            <div class="title">{{ 'SERIAL.BAUD_RATE' | translate }}</div>
            <div class="item-inner ccenter" (click)="openBaudList($event)">
              <div class="value">{{currentBaudRate}}</div>
              <div class="arrow-box">
                <i class="fa-light fa-angle-right arrow" [ngClass]="{'down':showBaudList}"></i>
              </div>
            </div>
          </div>
          <div class="setting-btn btn ccenter" nz-tooltip [nzTooltipTitle]="'SERIAL.MORE_SETTINGS' | translate"
            (click)="openMoreSettings()">
            @if(showMoreSettings){
            <i class="fa-light fa-xmark"></i>
            }@else {
            <i class="fa-light fa-gear"></i>
            }
          </div>
          <div class="switch">
            <nz-switch [(ngModel)]="switchValue" (ngModelChange)="switchPort()"></nz-switch>
          </div>
        </div>
      </div>
      @if(showMoreSettings){
      <app-setting-more [initialDataBits]="dataBits" [initialStopBits]="stopBits" [initialParity]="parity"
        [initialFlowControl]="flowControl" (settingsChanged)="onSettingsChanged($event)">
      </app-setting-more>
      }
      @if(showChartBox){
      <div class="chart-box">
        <div id="LightweightChart" style="width: 100%; height: 100%;"></div>
      </div>
      }

      <div class="monitor">
        <div class="r-box">

          <!-- 数据显示 -->
          <div class="data-list sscroll" #dataListBox>
            <div *uiScroll="let item of datasource">
              <app-data-item [data]="item" [searchKeyword]="searchKeyword"
                (click)="onDataItemClick(item)"></app-data-item>
            </div>
          </div>

          <div class="btns">
            <div class="btn ccenter hex" nz-tooltip [nzTooltipTitle]="'SERIAL.HEX_DISPLAY' | translate"
              (click)="changeViewMode('showHex')" [ngClass]="{'actived':showHex}">
              <i class="fa-thin fa-rectangle"></i>
              <div>Hex</div>
            </div>
            <div class="btn ccenter" nz-tooltip [nzTooltipTitle]="'SERIAL.AUTO_WRAP' | translate"
              (click)="changeViewMode('autoWrap')" [ngClass]="{'actived':autoWrap}">
              <i class="fa-light fa-arrow-turn-down-left"></i>
            </div>
            <div class="btn ccenter" nz-tooltip [nzTooltipTitle]="'SERIAL.AUTO_SCROLL' | translate"
              (click)="changeViewMode('autoScroll')" [ngClass]="{'actived':autoScroll}">
              <i class="fa-light fa-arrow-down-to-line"></i>
            </div>
            <div class="btn ccenter" nz-tooltip [nzTooltipTitle]="'SERIAL.TIMESTAMP' | translate"
              (click)="changeViewMode('showTimestamp')" [ngClass]="{'actived':showTimestamp}">
              <i class="fa-light fa-timer"></i>
            </div>
            <div class="btn ccenter" nz-tooltip [nzTooltipTitle]="'SERIAL.SHOW_CTRL_CHAR' | translate"
              (click)="changeViewMode('showCtrlChar')" [ngClass]="{'actived':showCtrlChar}">
              <i class="fa-light fa-eye"></i>
            </div>
            <!-- 折线图 -->
            <div class="btn ccenter right4" nz-tooltip [nzTooltipTitle]="'折线图' | translate" (click)="openChartBox()">
              <i class="fa-light fa-chart-line" [ngClass]="{'actived': showChartBox}"></i>
            </div>
            <!-- 数据图 -->
            <!-- <div class="btn ccenter right4" nz-tooltip [nzTooltipTitle]="'数据图' | translate"
              (click)="exportData()">
              <i class="fa-light fa-chart-tree-map"></i>
            </div> -->
            <!-- 搜索 -->
            <div class="btn ccenter right3" nz-tooltip [nzTooltipTitle]="'SERIAL.SEARCH' | translate"
              (click)="openSearchBox()">
              <i class="fa-light fa-magnifying-glass" [ngClass]="{'actived': searchBoxVisible}"></i>
            </div>
            <!-- 导出 -->
            <div class="btn ccenter right2" nz-tooltip [nzTooltipTitle]="'SERIAL.EXPORT' | translate"
              (click)="exportData()">
              <i class="fa-light fa-download"></i>
            </div>
            <div class="btn ccenter right" nz-tooltip [nzTooltipTitle]="'SERIAL.CLEAR' | translate"
              (click)="clearView()">
              <i class="fa-light fa-trash-can"></i>
            </div>
          </div>
          @if(searchBoxVisible) {
          <app-search-box (keywordChange)="keywordChange($event)" (prevResult)="navigatePrev()"
            (nextResult)="navigateNext()" [resultsCount]="searchResults.length" [currentIndex]="currentSearchIndex">
          </app-search-box>
          }
        </div>
      </div>
      <div class="sender" nz-resizable [style.height.px]="bottomHeight" [nzMaxHeight]="600" [nzMinHeight]="210"
        (nzResize)="onContentResize($event)">
        <nz-resize-handle nzDirection="top">
          <div class="line"></div>
        </nz-resize-handle>
        <div class="s-box">
          <!-- 快捷发送栏 -->
          <div class="settings" style="padding: 0;">
            <app-quick-send-list (openMore)="openQuickSendEditor()"></app-quick-send-list>
          </div>
          <div class="input-box">
            <textarea #chatTextarea class="sscroll vsfont" [(ngModel)]="inputValue" (keydown)="onKeyDown($event)">
            </textarea>
            <div class="btns">
              <div class="btn ccenter hex" nz-tooltip [nzTooltipTitle]="'SERIAL.HEX_DISPLAY' | translate"
                (click)="changeInputMode('hexMode')" [ngClass]="{'actived':hexMode}">
                <i class="fa-thin fa-rectangle"></i>
                <div>Hex</div>
              </div>
              <div class="btn ccenter enter" nz-tooltip [nzTooltipTitle]="'SERIAL.SEND_BY_ENTER' | translate"
                (click)="changeInputMode('sendByEnter')" [ngClass]="{'actived':sendByEnter}">
                <i class="fa-light fa-arrow-turn-down-left"></i>
              </div>
              <div class="btn ccenter enter" nz-tooltip [nzTooltipTitle]="'SERIAL.END_R' | translate"
                (click)="changeInputMode('endR')" [ngClass]="{'actived':endR}">
                <i class="fa-light fa-r"></i>
              </div>
              <div class="btn ccenter enter" nz-tooltip [nzTooltipTitle]="'SERIAL.END_N' | translate"
                (click)="changeInputMode('endN')" [ngClass]="{'actived':endN}">
                <i class="fa-light fa-n"></i>
              </div>
              <!-- <div class="btn ccenter right3" nz-tooltip nzTooltipTitle="历史记录" (click)="openHistoryList()">
              <i class="fa-light fa-clock-rotate-left"></i>
            </div> -->
              <div class="btn right ccenter" nz-tooltip [nzTooltipTitle]="sendByEnter?'Enter':'Ctrl+Enter'"
                (click)="send()">
                <i class="fa-light fa-paper-plane"></i>
              </div>
            </div>
          </div>
          @if(showHistoryList) {
          <app-history-message-list (close)="showHistoryList=false" (send)="send($event)"
            (value)="this.inputValue=$event;showHistoryList=false"></app-history-message-list>
          }
          @if(showQuickSendEditor){
          <app-quick-send-editor></app-quick-send-editor>
          }
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- device port list -->
@if (showPortList) {
<app-menu [position]="position" [width]="260" [menuList]="portList" (closeEvent)="closePortList()"
  [keywords]="boardKeywords" (itemClickEvent)="selectPort($event)"></app-menu>
}

<!-- baudrate list -->
@if (showBaudList) {
<app-menu [position]="position" [menuList]="baudList" (closeEvent)="closeBaudList()"
  (itemClickEvent)="selectBaud($event)"></app-menu>
}